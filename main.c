#include <stdio.h>
#include <gb/gb.h>

unsigned char ok[] =
{
  0x18,0x18,0x3F,0x3F,0x7F,0x7F,0xFF,0xFF,
  0x7F,0x7F,0x3F,0x3F,0x18,0x18,0x00,0x00,
  0x18,0x18,0xFC,0xFC,0xFE,0xFE,0xFF,0xFF,
  0xFF,0xFF,0xFE,0xFE,0xFC,0xFC,0x18,0x18,
  0x18,0x18,0x3C,0x3C,0x7E,0x7E,0xFF,0xFF,
  0xFF,0xFF,0x7E,0x7E,0x7E,0x7E,0x7E,0x7E,
  0x7E,0x7E,0x7E,0x7E,0x7E,0x7E,0xFF,0xFF,
  0xFF,0xFF,0x7E,0x7E,0x3C,0x3C,0x18,0x18
};

unsigned char tiles[] =
{
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
  0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF
};

unsigned char map[] =
{
  0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,
  0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,
  0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,
  0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,
  0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,
  0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,
  0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,
  0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,
  0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,
  0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01
};

UBYTE canMove(UINT8 pX, UINT8 pY){
        UINT16 tileX, tileY, tileByte;
        tileX = (pX - 8) / 8;
        tileY = (pY - 16) / 8;
        tileByte = 10 * tileX + tileY;
        
        return map[tileByte] != 0x01;
}

struct gameChar {
    UINT8 x;
    UINT8 y;
};

struct gameChar player;

void main(){
    DISPLAY_ON;
    printf("   \n\n\n     Press Start");
    waitpad(J_START);
    set_bkg_data(0, 7, tiles);
    set_bkg_tiles(0, 0, 10, 10, map);
    set_sprite_data(0, 4, ok);
    set_sprite_tile(0, 0);
    SHOW_BKG;
    SHOW_SPRITES;

    player.x = 32;
    player.y = 32;

    move_sprite(0, player.x, player.y);

    while(1){
       if(joypad() == J_RIGHT){
           set_sprite_tile(0, 1);
           if(canMove(player.x + 8, player.y)){
               player.x += 8;
           }
       } else if(joypad() == J_LEFT){
            set_sprite_tile(0, 0);
            if(canMove(player.x - 8, player.y)){
               player.x -= 8;
            }
       } else if(joypad() == J_UP){
            set_sprite_tile(0, 2);
            if(canMove(player.x, player.y - 8)){
               player.y -= 8;
            }
       } else if(joypad() == J_DOWN){
            set_sprite_tile(0, 3);
            if(canMove(player.x, player.y + 8)){
                player.y += 8;
            }
       }
        move_sprite(0, player.x, player.y);
        delay(100);
    }
}